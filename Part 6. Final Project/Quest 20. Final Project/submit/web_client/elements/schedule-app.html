<link rel="import" href="/polymer/polymer/polymer.html">
<link rel="import" href="/polymer/iron-ajax/iron-ajax.html">
<link rel="import" href="/polymer/iron-pages/iron-pages.html">
<link rel="import" href="/polymer/iron-selector/iron-selector.html">
<link rel="import" href="/polymer/app-layout/app-layout.html">
<link rel="import" href="/polymer/app-route/app-location.html">
<link rel="import" href="/polymer/app-route/app-route.html">
<link rel="import" href="/client/style/common-style.html">
<script src="/socket.io/socket.io.js"></script>

<dom-module id="schedule-app">
<style include="common-style">
:host{
	display: block;
	min-height:100vh;
}
app-drawer-layout{
	background: #f6f6f6;
}
app-drawer{
	position: fixed;
	display: block;
	background: #fff;
	bottom: 0;
}
.menu a{
	display: block;
	padding-left: 20px;
	height: 50px;
	line-height: 50px;
}
.sub-menu{
	display: block;
	background: rgba(0,0,0,0.08);
	transition:all .5s;
}
.sub-menu a{
	padding-left: 40px;
}
.menu > .iron-selected > a{
	font-weight: bold;
}
.menu > .iron-selected .sub-menu a.iron-selected{
	font-weight: bold;
}
app-header-layout{	
}
app-header{
	background: #fff;
}
</style>
<template strip-whitespace>
	<!-- 라우트 -->
	<app-location route="{{route}}"></app-location>
	<app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subRoute}}"></app-route>
	<app-route route="{{subRoute}}" pattern="/:subPage" data="{{subRouteData}}"></app-route>
	
	<!-- 레이아웃 -->
	<app-drawer-layout fullbleed>
		<!-- 메뉴 -->
		<app-drawer>
			<app-toolbar>
				YDSchedule
			</app-toolbar>
			<nav>
				<iron-selector class="menu" selected="[[page]]" attr-for-selected="name">
					<div name="main">
						<a href="/">HOME</a>
					</div>
					<div name="schedule">
						<a href="/schedule/check">일정</a>
						<iron-selector selected="[[subPage]]" class="sub-menu" attr-for-selected="name">
							<a name="check" href="/schedule/check">일정 확인</a>
							<a name="plus" href="/schedule/plus">일정 추가</a>
							<a name="provide" href="/schedule/provide">권유 받은 일정</a>
						</iron-selector>
					</div>
					<div name="friend">
						<a href="/friend/list">친구</a>
						<iron-selector selected="[[subPage]]" class="sub-menu" attr-for-selected="name">
							<a name="list" href="/friend/list">친구 목록</a>
							<a name="provide" href="/friend/provide">친구 초대</a>
						</iron-selector>
					</div>
				</iron-selector>
			</nav>
			<template is="dom-if" if="{{!login.status}}">
				<div>
					<a href="/googleOAuth/access" target="_blank">구글 계정으로 로그인</a>
				</div>
			</template>
			<template is="dom-if" if="{{login.status}}">

			</template>
		</app-drawer>
		<app-header-layout>
			<app-header>
				<app-toolbar>main site</app-toolbar>
			</app-header>

			<!-- 로그인 관련 ajax -->
			<iron-ajax auto url="/login/check" last-response="{{login}}"></iron-ajax>
			<template is="dom-if" if="{{!login.status}}">
				<div>
					not login
				</div>
			</template>
			<template is="dom-if" if="{{login.status}}">
				<div>
					login
				</div>
				<iron-pages class="pages" selected="[[page]]" attr-for-selected="name">
					<div name="main">
						sasas
					</div>
				</iron-pages>
			</template>
		</app-header-layout>
	</app-drawer-layout>
</template>
<script>
Polymer({
	loginSuccess : function() { //login_redirect.html에서 사용하는 함수
		this.set("login.status", true);
	},
	is : "schedule-app",
	redirect : function(path) {
		this.set("route.path", path);
	},
	ready : function() {
		window.app = window.app ? window.app : this;

		//this.setSocket(); //소켓 설정
	},
	setSocket : function() { // 소켓 설정
		var socket = this.socket = io();
		socket.on("connect", function() {
			
		});
	},
	observers : [
		"_routeObserver(routeData.page)",
		"_subPageObserver(subRouteData.subPage)"
	],
	_routeObserver : function(page) {
		this.page = page ? page : "main";
	},
	_subPageObserver : function(subPage) {
		this.subPage = subPage ? subPage : "main";
	},
	properties : {
		route : {
			type : Object
		},
		page : {
			type : String,
			value : ""
		},
		subPage : {
			type : String,
			value : ""
		}
	}
});
</script>
</dom-module>