<link rel="import" href="/polymer/polymer/polymer.html">
<link rel="import" href="/polymer/iron-ajax/iron-ajax.html">
<link rel="import" href="/polymer/iron-pages/iron-pages.html">
<link rel="import" href="/polymer/iron-selector/iron-selector.html">
<link rel="import" href="/polymer/app-layout/app-layout.html">
<link rel="import" href="/polymer/app-route/app-location.html">
<link rel="import" href="/polymer/app-route/app-route.html">
<link rel="import" href="/client/style/common-style.html">
<link rel="import" href="/client/behaviors.html">
<link rel="import" href="/elements/toast-alert.html">
<link rel="import" href="/elements/app-navigation.html">
<link rel="import" href="/elements/login-auth.html">
<script src="/socket.io/socket.io.js"></script>

<dom-module id="schedule-app">
<style include="common-style">
:host{
	display: block;
	min-height:100vh;
}
app-drawer-layout{
	background: var(--app-background);
}
app-drawer{
	--app-drawer-background :#fff;
	position: fixed;
	display: block;
	background: #fff;
	bottom: 0;
}
app-header-layout{
	min-height: 100%;
}
app-header{
	background: #fff;
}
app-header app-toolbar{
	padding-left: 10px;
}
login-auth{
	position: absolute;
	left: 50%;
	top: 50%;
	transform:translate(-50%, -50%);
}
</style>
<template strip-whitespace>
	<!-- 라우트 -->
	<app-location route="{{route}}"></app-location>
	<app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subRoute}}"></app-route>
	<app-route route="{{subRoute}}" pattern="/:subPage" data="{{subRouteData}}"></app-route>

	<!-- 알림 토스트 -->
	<toast-alert receive-node="{{toast}}"></toast-alert>
	
	<!-- 레이아웃 -->
	<app-drawer-layout fullbleed>
		<!-- 메뉴 -->
		<app-drawer>
			<app-navigation login="{{login}}" route="{{route}}"></app-navigation>
		</app-drawer>
		<app-header-layout has-scrolling-region>
			<app-header>
				<app-toolbar sticky>main site</app-toolbar>
			</app-header>

			<!-- 로그인 관련 ajax -->
			<iron-ajax auto url="/login/check" on-response="loginCheck"></iron-ajax>
			<iron-ajax url="login/logout" on-response="loginCheck" receive-node="{{logoutCall}}"></iron-ajax>
			<template is="dom-if" if="{{!login.login}}">
				<login-auth></login-auth>
			</template>
			<template is="dom-if" if="{{login.login}}">
				<iron-pages class="pages" selected="[[page]]" attr-for-selected="name">
					<div name="main">
						sasas
					</div>
				</iron-pages>
			</template>
		</app-header-layout>
	</app-drawer-layout>
</template>
<script>
Polymer({
	is : "schedule-app",
	behaviors : [routeBehavior],
	loginCheck : function(data) {
		this.login = data.detail.response;
	},
	_loginSuccess : function() { //login_redirect.html에서 사용하는 함수
		this.set("login.login", true);
		this.toast.alert("로그인 완료");
	},
	redirect : function(path) {
		this.set("route.path", path);
	},
	ready : function() {
		window.app = window.app ? window.app : this;

		//this.setSocket(); //소켓 설정
	},
	setSocket : function() { // 소켓 설정
		var socket = this.socket = io();
		socket.on("connect", function() {
			
		});
	}
});
</script>
</dom-module>