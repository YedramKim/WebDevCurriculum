<script>
var iconBehaviors = {
	ready : function() {
		console.log(this.x);
	},
	properties : {
		iconTitle : { //아이콘 제목
			type : String,
			notify : true,
			reflectToAttribute : true,
			value : ""
		},
		x : { //아이콘의 x좌표(원위치를 0으로 기준)
			type : Number,
			value : 0
		},
		y : { //아이콘의 y좌표(원위치를 0으로 기준)
			type : Number,
			value : 0
		},
		ex : { //아이콘의 x좌표(전 이벤트 끝났을 때 혹은 처음 좌표를 기준)
			type : Number,
			value : 0
		},
		ey : { //아이콘의 y좌표(전 이벤트 끝났을 때 혹은 처음 좌표를 기준)
			type : Number,
			value : 0
		}
	},
	ready : function() {

	},
	listeners : { //track리스너 지정
		"track" : "_trackIcon",
		"mousedown" : "fireRiseZIndex"
	},
	_trackIcon : function(e) { //track리스너
		//track이벤트의 상태 (start or track or end)
		var state = e.detail.state;
		
		//현재 마우스 좌표
		var pageX = e.detail.sourceEvent.pageX;
		var pageY = e.detail.sourceEvent.pageY;

		//부모 노드인 app-desktop의 위치정보
		var parentPos = this.parentNode.getBoundingClientRect();
		var left = parentPos.left;
		var top = parentPos.left;
		var width = left + parentPos.width;
		var height = top + parentPos.height;
		//만약에 마우스가 부모 노드를 벗어났을 경우 이벤트를 취소한다.
		if(pageX < left || pageY < top || pageX > width || pageY > height) {
			return;
		}
		
		//드래그 중일 때 아이콘이 이동한다.
		if(state === "track") {
			this.x = this.ex + e.detail.dx;
			this.y = this.ey + e.detail.dy;
		}else if(state === "end") {
			this.x = this.ex + e.detail.dx;
			this.y = this.ey + e.detail.dy;

			//드래그가 끝나면 ex와 ey를 수정한다.
			this.ex += e.detail.dx;
			this.ey += e.detail.dy;
		}
	},
	fireRiseZIndex : function() {
		this.fire("riseZIndex");
	},
	observers : [ //x, y 속성의 옵저버
		"_setIconPosition(x, y)"
	],
	_setIconPosition : function(x, y) { //x, y 속성이 바뀔때마다 위치가 변경
		this.style.left = x + "px";
		this.style.top = y + "px";
	}
}
</script>

<dom-module id="icon-style">
	<template>
		<style>
		:host{
			display: inline-block;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			-o-user-select: none;
			user-select: none;
			z-index: 1;
			border: 1px solid transparent;
			padding: 10px;
			position: relative;
			cursor: default;
		}
		:host:hover{
			border-color: #b9dbff;
			background: rgba(185, 219, 255, 0.5);
		}
		:host:active{
			background: rgba(185, 219, 255, 0.7);
		}
		.iconImage{
			width: 100px;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			-o-user-select: none;
			user-select: none;
		}
		.icon-title{
			text-align: center;
			margin: 0;
			font-weight: bold;
			font-family: "Malgun Gothic";
		}
		.cover{
			position: absolute;
			left: 0;
			top: 0;
			bottom: 0;
			right: 0;
		}
		</style>
	</template>
</dom-module>